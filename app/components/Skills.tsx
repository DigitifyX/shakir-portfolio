"use client";

import React, { useEffect, useRef, useCallback, useState } from "react";
import { motion } from "framer-motion";
import AnimatedSectionHeading from "./AnimatedSectionHeading";

// Technology data
const technologies = [
  { name: "React", color: "#61DAFB" },
  { name: "Next.js", color: "#ffffff" },
  { name: "TypeScript", color: "#3178C6" },
  { name: "JavaScript", color: "#F7DF1E" },
  { name: "Node.js", color: "#339933" },
  { name: "HTML5", color: "#E34F26" },
  { name: "CSS3", color: "#1572B6" },
  { name: "Git", color: "#F05032" },
  { name: "GitHub", color: "#ffffff", isCenter: true },
  { name: "Docker", color: "#2496ED" },
  { name: "AWS", color: "#FF9900" },
  { name: "MongoDB", color: "#47A248" },
  { name: "MySQL", color: "#4479A1" },
  { name: "WordPress", color: "#21759B" },
  { name: "GoHighLevel", color: "#FF6B35" },
  { name: "n8n", color: "#EA4B71" },
  { name: "ClickFunnels", color: "#0066FF" },
  { name: "Zapier", color: "#FF4A00" },
  { name: "Redux", color: "#764ABC" },
  { name: "Tailwind", color: "#06B6D4" },
  { name: "Express", color: "#ffffff" },
  { name: "VS Code", color: "#007ACC" },
  { name: "Figma", color: "#F24E1E" },
  { name: "Vercel", color: "#ffffff" },
  { name: "Flutter", color: "#02569B" },
  { name: "Firebase", color: "#FFCA28" },
  { name: "GraphQL", color: "#E10098" },
  { name: "Sass", color: "#CC6699" },
  { name: "Jest", color: "#C21325" },
  { name: "Cypress", color: "#17202C" },
  { name: "Framer", color: "#0055FF" },
  { name: "Sanity", color: "#F03E2F" },
];

// Icon Components - keeping them the same
function IconByName({ name, color }: { name: string; color: string }) {
  const iconMap: Record<string, React.ReactElement> = {
    React: (
      <svg viewBox="0 0 24 24" fill={color} className="w-full h-full">
        <path d="M12 9.861a2.139 2.139 0 100 4.278 2.139 2.139 0 100-4.278zm-5.992 6.394l-.472-.12C2.018 15.246 0 13.737 0 11.996s2.018-3.25 5.536-4.139l.472-.119.133.468a23.53 23.53 0 001.363 3.578l.101.213-.101.213a23.307 23.307 0 00-1.363 3.578l-.133.467zM5.317 8.95c-2.674.751-4.315 1.9-4.315 3.046 0 1.145 1.641 2.294 4.315 3.046a24.95 24.95 0 011.182-3.046A24.752 24.752 0 015.317 8.95zm12.675 7.305l-.133-.469a23.357 23.357 0 00-1.364-3.577l-.101-.213.101-.213a23.42 23.42 0 001.364-3.578l.133-.468.473.119c3.517.889 5.535 2.398 5.535 4.14s-2.018 3.25-5.535 4.139l-.473.12zm-.491-4.259c.48 1.039.877 2.06 1.182 3.046 2.675-.752 4.315-1.901 4.315-3.046 0-1.146-1.641-2.294-4.315-3.046a24.788 24.788 0 01-1.182 3.046zM5.31 8.945l-.133-.467C4.188 4.992 4.488 2.494 6 1.622c1.483-.856 3.864.155 6.359 2.716l.34.349-.34.349a23.552 23.552 0 00-2.422 2.967l-.135.193-.235.02a23.657 23.657 0 00-3.785.61l-.472.119zm1.896-6.63c-.268 0-.505.058-.705.173-.994.573-1.17 2.565-.485 5.253a25.122 25.122 0 013.233-.501 24.847 24.847 0 012.052-2.544c-1.56-1.519-3.037-2.381-4.095-2.381zm9.589 20.362c-.001 0-.001 0 0 0-1.425 0-3.255-1.073-5.154-3.023l-.34-.349.34-.349a23.53 23.53 0 002.421-2.968l.135-.193.234-.02a23.63 23.63 0 003.787-.609l.472-.119.134.468c.987 3.484.688 5.983-.824 6.854a2.38 2.38 0 01-1.205.308zm-4.096-3.381c1.56 1.519 3.037 2.381 4.095 2.381h.001c.267 0 .505-.058.704-.173.994-.573 1.171-2.566.485-5.254a25.02 25.02 0 01-3.234.501 24.674 24.674 0 01-2.051 2.545zM18.69 8.945l-.472-.119a23.479 23.479 0 00-3.787-.61l-.234-.02-.135-.193a23.414 23.414 0 00-2.421-2.967l-.34-.349.34-.349C14.135 1.778 16.515.767 18 1.622c1.512.872 1.812 3.37.824 6.855l-.134.468zM14.75 7.24c1.142.104 2.227.273 3.234.501.686-2.688.509-4.68-.485-5.253-.988-.571-2.845.304-4.8 2.208A24.849 24.849 0 0114.75 7.24zM7.206 22.677A2.38 2.38 0 016 22.369c-1.512-.871-1.812-3.369-.823-6.854l.132-.468.472.119c1.155.291 2.429.496 3.785.609l.235.02.134.193a23.596 23.596 0 002.422 2.968l.34.349-.34.349c-1.898 1.95-3.728 3.023-5.151 3.023zm-1.19-6.427c-.686 2.688-.509 4.681.485 5.254.987.563 2.843-.305 4.8-2.208a24.998 24.998 0 01-2.052-2.545 24.976 24.976 0 01-3.233-.501zm5.984.628c-.823 0-1.669-.036-2.516-.106l-.235-.02-.135-.193a30.388 30.388 0 01-1.35-2.122 30.354 30.354 0 01-1.166-2.228l-.1-.213.1-.213a30.3 30.3 0 011.166-2.228c.414-.716.869-1.43 1.35-2.122l.135-.193.235-.02a29.785 29.785 0 015.033 0l.234.02.134.193a30.006 30.006 0 012.517 4.35l.101.213-.101.213a29.6 29.6 0 01-2.517 4.35l-.134.193-.234.02c-.847.07-1.694.106-2.517.106zm-2.197-1.084c1.48.111 2.914.111 4.395 0a29.006 29.006 0 002.196-3.798 28.585 28.585 0 00-2.197-3.798 29.031 29.031 0 00-4.394 0 28.477 28.477 0 00-2.197 3.798 29.114 29.114 0 002.197 3.798z" />
      </svg>
    ),
    "Next.js": (
      <svg viewBox="0 0 24 24" fill={color} className="w-full h-full">
        <path d="M11.572 0c-.176 0-.31.001-.358.007a19.76 19.76 0 01-.364.033C7.443.346 4.25 2.185 2.228 5.012a11.875 11.875 0 00-2.119 5.243c-.096.659-.108.854-.108 1.747s.012 1.089.108 1.748c.652 4.506 3.86 8.292 8.209 9.695.779.25 1.6.422 2.534.525.363.04 1.935.04 2.299 0 1.611-.178 2.977-.577 4.323-1.264.207-.106.247-.134.219-.158-.02-.013-.9-1.193-1.955-2.62l-1.919-2.592-2.404-3.558a338.739 338.739 0 00-2.422-3.556c-.009-.002-.018 1.579-.023 3.51-.007 3.38-.01 3.515-.052 3.595a.426.426 0 01-.206.214c-.075.037-.14.044-.495.044H7.81l-.108-.068a.438.438 0 01-.157-.171l-.05-.106.006-4.703.007-4.705.072-.092a.645.645 0 01.174-.143c.096-.047.134-.051.54-.051.478 0 .558.018.682.154.035.038 1.337 1.999 2.895 4.361a10760.433 10760.433 0 004.735 7.17l1.9 2.879.096-.063a12.317 12.317 0 002.466-2.163 11.944 11.944 0 002.824-6.134c.096-.66.108-.854.108-1.748 0-.893-.012-1.088-.108-1.747-.652-4.506-3.859-8.292-8.208-9.695a12.597 12.597 0 00-2.499-.523A33.119 33.119 0 0011.572 0zm4.069 7.217c.347 0 .408.005.486.047a.473.473 0 01.237.277c.018.06.023 1.365.018 4.304l-.006 4.218-.744-1.14-.746-1.14v-3.066c0-1.982.01-3.097.023-3.15a.478.478 0 01.233-.296c.096-.05.13-.054.5-.054z" />
      </svg>
    ),
    TypeScript: (
      <svg viewBox="0 0 24 24" fill={color} className="w-full h-full">
        <path d="M1.125 0C.502 0 0 .502 0 1.125v21.75C0 23.498.502 24 1.125 24h21.75c.623 0 1.125-.502 1.125-1.125V1.125C24 .502 23.498 0 22.875 0zm17.363 9.75c.612 0 1.154.037 1.627.111a6.38 6.38 0 011.306.34v2.458a3.95 3.95 0 00-.643-.361 5.093 5.093 0 00-.717-.26 5.453 5.453 0 00-1.426-.2c-.3 0-.573.028-.819.086a2.1 2.1 0 00-.623.242c-.17.104-.3.229-.393.374a.888.888 0 00-.14.49c0 .196.053.373.156.529.104.156.252.304.443.444s.423.276.696.41c.273.135.582.274.926.416.47.197.892.407 1.266.628.374.222.695.473.963.753.268.279.472.598.614.957.142.359.214.776.214 1.253 0 .657-.125 1.21-.373 1.656a3.033 3.033 0 01-1.012 1.085 4.38 4.38 0 01-1.487.596c-.566.12-1.163.18-1.79.18a9.916 9.916 0 01-1.84-.164 5.544 5.544 0 01-1.512-.493v-2.63a5.033 5.033 0 003.237 1.2c.333 0 .624-.03.872-.09.249-.06.456-.144.623-.25.166-.108.29-.234.373-.38a1.023 1.023 0 00-.074-1.089 2.12 2.12 0 00-.537-.5 5.597 5.597 0 00-.807-.444 27.72 27.72 0 00-1.007-.436c-.918-.383-1.602-.852-2.053-1.405-.45-.553-.676-1.222-.676-2.005 0-.614.123-1.141.369-1.582.246-.441.58-.804 1.004-1.089a4.494 4.494 0 011.47-.629 7.536 7.536 0 011.77-.201zm-15.113.188h9.563v2.166H9.506v9.646H6.789v-9.646H3.375z" />
      </svg>
    ),
    JavaScript: (
      <svg viewBox="0 0 24 24" fill={color} className="w-full h-full">
        <path d="M0 0h24v24H0V0zm22.034 18.276c-.175-1.095-.888-2.015-3.003-2.873-.736-.345-1.554-.585-1.797-1.14-.091-.33-.105-.51-.046-.705.15-.646.915-.84 1.515-.66.39.12.75.42.976.9 1.034-.676 1.034-.676 1.755-1.125-.27-.42-.404-.601-.586-.78-.63-.705-1.469-1.065-2.834-1.034l-.705.089c-.676.165-1.32.525-1.71 1.005-1.14 1.291-.811 3.541.569 4.471 1.365 1.02 3.361 1.244 3.616 2.205.24 1.17-.87 1.545-1.966 1.41-.811-.18-1.26-.586-1.755-1.336l-1.83 1.051c.21.48.45.689.81 1.109 1.74 1.756 6.09 1.666 6.871-1.004.029-.09.24-.705.074-1.65l.046.067zm-8.983-7.245h-2.248c0 1.938-.009 3.864-.009 5.805 0 1.232.063 2.363-.138 2.711-.33.689-1.18.601-1.566.48-.396-.196-.597-.466-.83-.855-.063-.105-.11-.196-.127-.196l-1.825 1.125c.305.63.75 1.172 1.324 1.517.855.51 2.004.675 3.207.405.783-.226 1.458-.691 1.811-1.411.51-.93.402-2.07.397-3.346.012-2.054 0-4.109 0-6.179l.004-.056z" />
      </svg>
    ),
    "Node.js": (
      <svg viewBox="0 0 24 24" fill={color} className="w-full h-full">
        <path d="M11.998 24c-.321 0-.641-.084-.922-.247l-2.936-1.737c-.438-.245-.224-.332-.08-.383.585-.203.703-.25 1.328-.604.065-.037.151-.023.218.017l2.256 1.339a.29.29 0 00.272 0l8.795-5.076a.277.277 0 00.134-.238V6.921a.283.283 0 00-.137-.242l-8.791-5.072a.278.278 0 00-.271 0L3.075 6.68a.284.284 0 00-.139.241v10.15a.27.27 0 00.139.235l2.409 1.392c1.307.654 2.108-.116 2.108-.89V7.787c0-.142.114-.253.256-.253h1.115c.139 0 .255.112.255.253v10.021c0 1.745-.95 2.745-2.604 2.745-.508 0-.909 0-2.026-.551L2.28 18.675a1.857 1.857 0 01-.922-1.604V6.921c0-.659.353-1.275.922-1.603l8.795-5.082c.557-.315 1.296-.315 1.848 0l8.794 5.082c.57.329.924.944.924 1.603v10.15a1.86 1.86 0 01-.924 1.604l-8.795 5.078c-.28.163-.6.247-.924.247z" />
      </svg>
    ),
    HTML5: (
      <svg viewBox="0 0 24 24" fill={color} className="w-full h-full">
        <path d="M1.5 0h21l-1.91 21.563L11.977 24l-8.564-2.438L1.5 0zm7.031 9.75l-.232-2.718 10.059.003.23-2.622L5.412 4.41l.698 8.01h9.126l-.326 3.426-2.91.804-2.955-.81-.188-2.11H6.248l.33 4.171L12 19.351l5.379-1.443.744-8.157H8.531z" />
      </svg>
    ),
    CSS3: (
      <svg viewBox="0 0 24 24" fill={color} className="w-full h-full">
        <path d="M1.5 0h21l-1.91 21.563L11.977 24l-8.565-2.438L1.5 0zm17.09 4.413L5.41 4.41l.213 2.622 10.125.002-.255 2.716h-6.64l.24 2.573h6.182l-.366 3.523-2.91.804-2.956-.81-.188-2.11h-2.61l.29 3.855L12 19.288l5.373-1.53L18.59 4.414z" />
      </svg>
    ),
    Git: (
      <svg viewBox="0 0 24 24" fill={color} className="w-full h-full">
        <path d="M23.546 10.93L13.067.452a1.55 1.55 0 00-2.188 0L8.708 2.627l2.76 2.76a1.838 1.838 0 012.327 2.341l2.658 2.66a1.838 1.838 0 011.9 3.039 1.837 1.837 0 01-2.6 0 1.846 1.846 0 01-.404-1.996L12.86 8.955v6.525c.176.086.342.203.488.348a1.848 1.848 0 010 2.6 1.844 1.844 0 01-2.609 0 1.834 1.834 0 010-2.598c.182-.18.387-.316.605-.406V8.835a1.834 1.834 0 01-.996-2.41L7.636 3.7.45 10.881c-.6.605-.6 1.584 0 2.189l10.48 10.477a1.545 1.545 0 002.186 0l10.43-10.43a1.544 1.544 0 000-2.187" />
      </svg>
    ),
    GitHub: (
      <svg viewBox="0 0 24 24" fill={color} className="w-full h-full">
        <path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12" />
      </svg>
    ),
    Docker: (
      <svg viewBox="0 0 24 24" fill={color} className="w-full h-full">
        <path d="M13.983 11.078h2.119a.186.186 0 00.186-.185V9.006a.186.186 0 00-.186-.186h-2.119a.185.185 0 00-.185.185v1.888c0 .102.083.185.185.185m-2.954-5.43h2.118a.186.186 0 00.186-.186V3.574a.186.186 0 00-.186-.185h-2.118a.185.185 0 00-.185.185v1.888c0 .102.082.185.185.186m0 2.716h2.118a.187.187 0 00.186-.186V6.29a.186.186 0 00-.186-.185h-2.118a.185.185 0 00-.185.185v1.887c0 .102.082.185.185.186m-2.93 0h2.12a.186.186 0 00.184-.186V6.29a.185.185 0 00-.185-.185H8.1a.185.185 0 00-.185.185v1.887c0 .102.083.185.185.186m-2.964 0h2.119a.186.186 0 00.185-.186V6.29a.185.185 0 00-.185-.185H5.136a.186.186 0 00-.186.185v1.887c0 .102.084.185.186.186m5.893 2.715h2.118a.186.186 0 00.186-.185V9.006a.186.186 0 00-.186-.186h-2.118a.185.185 0 00-.185.185v1.888c0 .102.082.185.185.185m-2.93 0h2.12a.185.185 0 00.184-.185V9.006a.185.185 0 00-.184-.186h-2.12a.185.185 0 00-.184.185v1.888c0 .102.083.185.185.185m-2.964 0h2.119a.185.185 0 00.185-.185V9.006a.185.185 0 00-.184-.186h-2.12a.186.186 0 00-.186.186v1.887c0 .102.084.185.186.185m-2.92 0h2.12a.185.185 0 00.184-.185V9.006a.185.185 0 00-.184-.186h-2.12a.185.185 0 00-.184.185v1.888c0 .102.082.185.185.185M23.763 9.89c-.065-.051-.672-.51-1.954-.51-.338.001-.676.03-1.01.087-.248-1.7-1.653-2.53-1.716-2.566l-.344-.199-.226.327c-.284.438-.49.922-.612 1.43-.23.97-.09 1.882.403 2.661-.595.332-1.55.413-1.744.42H.751a.751.751 0 00-.75.748 11.376 11.376 0 00.692 4.062c.545 1.428 1.355 2.48 2.41 3.124 1.18.723 3.1 1.137 5.275 1.137.983.003 1.963-.086 2.93-.266a12.248 12.248 0 003.823-1.389c.98-.567 1.86-1.288 2.61-2.136 1.252-1.418 1.998-2.997 2.553-4.4h.221c1.372 0 2.215-.549 2.68-1.009.309-.293.55-.65.707-1.046l.098-.288z" />
      </svg>
    ),
    AWS: (
      <svg viewBox="0 0 24 24" fill={color} className="w-full h-full">
        <path d="M6.763 10.036c0 .296.032.535.088.71.064.176.144.368.256.576.04.063.056.127.056.183 0 .08-.048.16-.152.24l-.503.335a.383.383 0 01-.208.072c-.08 0-.16-.04-.239-.112a2.47 2.47 0 01-.287-.375 6.18 6.18 0 01-.248-.471c-.622.734-1.405 1.101-2.347 1.101-.67 0-1.205-.191-1.596-.574-.391-.384-.59-.894-.59-1.533 0-.678.239-1.23.726-1.644.487-.415 1.133-.623 1.955-.623.272 0 .551.024.846.064.296.04.6.104.918.176v-.583c0-.607-.127-1.03-.375-1.277-.255-.248-.686-.367-1.3-.367-.28 0-.568.031-.863.103-.295.072-.583.16-.862.272a2.287 2.287 0 01-.28.104.488.488 0 01-.127.023c-.112 0-.168-.08-.168-.247v-.391c0-.128.016-.224.056-.28a.597.597 0 01.224-.167c.279-.144.614-.264 1.005-.36a4.84 4.84 0 011.246-.151c.95 0 1.644.216 2.091.647.439.43.662 1.085.662 1.963v2.586zm-3.24 1.214c.263 0 .534-.048.822-.144.287-.096.543-.271.758-.51.128-.152.224-.32.272-.512.047-.191.08-.423.08-.694v-.335a6.66 6.66 0 00-.735-.136 6.02 6.02 0 00-.75-.048c-.535 0-.926.104-1.19.32-.263.215-.39.518-.39.917 0 .375.095.655.295.846.191.2.47.296.838.296zm6.41.862c-.144 0-.24-.024-.304-.08-.064-.048-.12-.16-.168-.311L7.586 5.55a1.398 1.398 0 01-.072-.32c0-.128.064-.2.191-.2h.783c.151 0 .255.025.31.08.065.048.113.16.16.312l1.342 5.284 1.245-5.284c.04-.16.088-.264.151-.312a.549.549 0 01.32-.08h.638c.152 0 .256.025.32.08.063.048.12.16.151.312l1.261 5.348 1.381-5.348c.048-.16.104-.264.16-.312a.52.52 0 01.311-.08h.743c.127 0 .2.065.2.2 0 .04-.009.08-.017.128a1.137 1.137 0 01-.056.2l-1.923 6.17c-.048.16-.104.263-.168.311a.51.51 0 01-.303.08h-.687c-.151 0-.255-.024-.32-.08-.063-.056-.119-.16-.15-.32l-1.238-5.148-1.23 5.14c-.04.16-.087.264-.15.32-.065.056-.177.08-.32.08zm10.256.215c-.415 0-.83-.048-1.229-.143-.399-.096-.71-.2-.918-.32-.128-.071-.215-.151-.247-.223a.563.563 0 01-.048-.224v-.407c0-.167.064-.247.183-.247.048 0 .096.008.144.024.048.016.12.048.2.08.271.12.566.215.878.279.319.064.63.096.95.096.502 0 .894-.088 1.165-.264a.86.86 0 00.415-.758.777.777 0 00-.215-.559c-.144-.151-.416-.287-.807-.414l-1.157-.36c-.583-.183-1.014-.454-1.277-.813a1.902 1.902 0 01-.4-1.158c0-.335.073-.63.216-.886.144-.255.335-.479.575-.654.24-.184.51-.32.83-.415.32-.096.655-.136 1.006-.136.175 0 .359.008.535.032.183.024.35.056.518.088.16.04.312.08.455.127.144.048.256.096.336.144a.69.69 0 01.24.2.43.43 0 01.071.263v.375c0 .168-.064.256-.184.256a.83.83 0 01-.303-.096 3.652 3.652 0 00-1.532-.311c-.455 0-.815.071-1.062.223-.248.152-.375.383-.375.71 0 .224.08.416.24.567.159.152.454.304.877.44l1.134.358c.574.184.99.44 1.237.767.247.327.367.702.367 1.117 0 .343-.072.655-.207.926-.144.272-.336.511-.583.703-.248.2-.543.343-.886.447-.36.111-.734.167-1.142.167zM21.698 16.207c-2.626 1.94-6.442 2.969-9.722 2.969-4.598 0-8.74-1.7-11.87-4.526-.247-.223-.024-.527.27-.351 3.384 1.963 7.559 3.153 11.877 3.153 2.914 0 6.114-.607 9.06-1.852.439-.2.814.287.385.607zM22.792 14.961c-.336-.43-2.22-.207-3.074-.103-.255.032-.295-.192-.063-.36 1.5-1.053 3.967-.75 4.254-.399.287.36-.08 2.826-1.485 4.007-.215.184-.423.088-.327-.151.32-.79 1.03-2.57.695-2.994z" />
      </svg>
    ),
    MongoDB: (
      <svg viewBox="0 0 24 24" fill={color} className="w-full h-full">
        <path d="M17.193 9.555c-1.264-5.58-4.252-7.414-4.573-8.115-.28-.394-.53-.954-.735-1.44-.036.495-.055.685-.523 1.184-.723.566-4.438 3.682-4.74 10.02-.282 5.912 4.27 9.435 4.888 9.884l.07.05A73.49 73.49 0 0111.91 24h.481c.114-1.032.284-2.056.51-3.07.417-.296.604-.463.85-.693a11.342 11.342 0 003.639-8.464c.01-.814-.103-1.662-.197-2.218zm-5.336 8.195s0-8.291.275-8.29c.213 0 .49 10.695.49 10.695-.381-.045-.765-1.76-.765-2.405z" />
      </svg>
    ),
    MySQL: (
      <svg viewBox="0 0 24 24" fill={color} className="w-full h-full">
        <path d="M16.405 5.501c-.115 0-.193.014-.274.033v.013h.014c.054.104.146.18.214.273.054.107.1.214.154.32l.014-.015c.094-.066.14-.172.14-.333-.04-.047-.046-.094-.08-.14-.04-.067-.126-.1-.18-.153zM5.77 18.695h-.927a50.854 50.854 0 00-.27-4.41h-.008l-1.41 4.41H2.45l-1.4-4.41h-.01a72.892 72.892 0 00-.195 4.41H0c.055-1.966.192-3.81.41-5.53h1.15l1.335 4.064h.008l1.347-4.063h1.095c.242 2.015.384 3.86.428 5.53zm4.017-4.08c-.378 2.045-.876 3.533-1.492 4.46-.482.723-1.01 1.086-1.583 1.086-.153 0-.34-.046-.566-.138v-.494c.11.017.24.026.386.026.268 0 .483-.075.647-.222.197-.18.295-.382.295-.605 0-.155-.077-.47-.23-.944L6.23 14.615h.91l.727 2.36c.164.536.233.91.205 1.123.4-1.064.678-2.227.835-3.483zm12.325 4.08h-2.63v-5.53h.885v4.85h1.745zm-3.32.135l-1.016-.5c.09-.076.177-.158.255-.25.433-.506.648-1.258.648-2.253 0-1.83-.718-2.746-2.155-2.746-.704 0-1.254.232-1.65.697-.43.508-.646 1.256-.646 2.245 0 .972.19 1.686.574 2.14.35.41.877.615 1.583.615.264 0 .506-.033.725-.098l1.325.772.36-.622z" />
      </svg>
    ),
    WordPress: (
      <svg viewBox="0 0 24 24" fill={color} className="w-full h-full">
        <path d="M21.469 6.825c.84 1.537 1.318 3.3 1.318 5.175 0 3.979-2.156 7.456-5.363 9.325l3.295-9.527c.615-1.54.82-2.771.82-3.864 0-.405-.026-.78-.07-1.109m-7.981.105c.647-.034 1.23-.1 1.23-.1.578-.068.51-.919-.07-.886 0 0-1.74.137-2.861.137-1.055 0-2.83-.137-2.83-.137-.578-.033-.648.852-.068.886 0 0 .548.066 1.13.1l1.677 4.594-2.357 7.07-3.923-11.664c.647-.034 1.23-.1 1.23-.1.578-.068.51-.919-.07-.886 0 0-1.74.137-2.861.137-.2 0-.436-.005-.689-.014C6.693 3.044 9.768 1.905 12 1.905c1.977 0 3.78.636 5.254 1.715-.033-.002-.065-.006-.1-.007-.953 0-1.628.834-1.628 1.73 0 .803.464 1.484.957 2.287.37.644.803 1.47.803 2.666 0 .827-.317 1.787-.737 3.125l-.966 3.223-3.494-10.39m-3.44 14.633l2.94-8.537 3.008 8.238c.02.047.041.092.066.135-1.248.45-2.593.694-3.992.694-1.27 0-2.485-.217-3.62-.613.04-.018.08-.04.118-.065L12 21.563M1.213 12c0-2.084.536-4.04 1.478-5.744L7.163 20.57C3.67 18.65 1.213 15.07 1.213 12M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0" />
      </svg>
    ),
    GoHighLevel: (
      <svg viewBox="0 0 24 24" fill={color} className="w-full h-full">
        <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" stroke={color} strokeWidth="2" fill="none" />
      </svg>
    ),
    n8n: (
      <svg viewBox="0 0 24 24" fill={color} className="w-full h-full">
        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 15h-2v-6h2v6zm4 0h-2v-6h2v6zm-2-8c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1z" />
      </svg>
    ),
    ClickFunnels: (
      <svg viewBox="0 0 24 24" fill={color} className="w-full h-full">
        <path d="M12 2L4 6v12l8 4 8-4V6l-8-4zm0 2.18l5.5 2.75L12 9.68 6.5 6.93 12 4.18zM6 8.82l5 2.5v7.36l-5-2.5V8.82zm12 7.36l-5 2.5v-7.36l5-2.5v7.36z" />
      </svg>
    ),
    Zapier: (
      <svg viewBox="0 0 24 24" fill={color} className="w-full h-full">
        <path d="M15.5 12l4-4c.4-.4.4-1 0-1.4l-2.1-2.1c-.4-.4-1-.4-1.4 0l-4 4-4-4c-.4-.4-1-.4-1.4 0L4.5 6.6c-.4.4-.4 1 0 1.4l4 4-4 4c-.4.4-.4 1 0 1.4l2.1 2.1c.4.4 1 .4 1.4 0l4-4 4 4c.4.4 1 .4 1.4 0l2.1-2.1c.4-.4.4-1 0-1.4l-4-4zM12 14c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z" />
      </svg>
    ),
    Redux: (
      <svg viewBox="0 0 24 24" fill={color} className="w-full h-full">
        <path d="M16.634 16.504c.87-.075 1.543-.818 1.5-1.705-.043-.888-.771-1.605-1.676-1.605h-.062c-.904.043-1.61.818-1.567 1.706.043.457.228.853.514 1.127-.514 1.082-1.294 1.875-2.474 2.545-1.053.593-2.163.856-3.272.77-.879-.056-1.577-.399-2.063-.983-.599-.79-.685-1.666-.228-2.545.328-.628.856-1.092 1.2-1.321-.072-.257-.172-.685-.215-1.004-2.748 1.973-2.462 4.636-1.633 5.892.618.944 1.876 1.533 3.273 1.533.342 0 .703-.043 1.044-.104 2.248-.4 3.958-1.648 4.988-3.268.086-.028.171-.057.257-.086.257.047.514.019.771-.047v.076c.043.9.685 1.647 1.576 1.69h.062c.856 0 1.576-.728 1.619-1.604.043-.9-.628-1.648-1.548-1.733h-.047c-.1 0-.199.014-.299.028l-.356.072c-.128-.343-.228-.728-.271-1.148-.013-.1-.027-.199-.027-.313v-.399c1.533-1.762 2.162-3.682 1.877-5.501-.2-1.249-.857-2.332-1.905-3.077C18.77.414 16.52-.196 14.167.058c-1.734.2-3.324.943-4.463 2.092-1.32 1.316-2.017 3.077-1.916 4.91l.99.285c-.086-2.56 1.319-4.708 3.368-5.65.857-.372 2.02-.643 3.295-.543 1.449.113 2.633.599 3.39 1.39.771.828 1.143 1.918 1.057 3.163-.071 1.25-.5 2.418-1.186 3.44-.357-.485-.871-.885-1.533-1.114-.042-.014-.085-.028-.128-.042-.385-.114-.785-.157-1.186-.114l.1-.242c.142-.442.228-.899.228-1.376 0-.657-.157-1.29-.428-1.861l-.043-.086c-.428-.828-1.1-1.519-1.933-1.976l-.143-.086c-.814-.414-1.718-.6-2.647-.543h-.086c-.914.057-1.762.343-2.505.814l-.086.057c-.771.514-1.39 1.214-1.79 2.028-.414.857-.543 1.79-.385 2.718.056.314.156.628.27.914l.058.171c.456 1.048 1.276 1.904 2.276 2.404.543.271 1.128.456 1.734.528.013-.199.043-.399.072-.6.042-.185.1-.37.156-.542-.485-.043-.956-.2-1.39-.443l-.129-.086c-.643-.385-1.128-.985-1.39-1.704l-.057-.114a3.305 3.305 0 01-.114-1.82c.1-.6.386-1.143.771-1.59.385-.457.9-.8 1.458-.985.285-.1.6-.157.913-.185h.143c.385 0 .785.057 1.156.185l.114.043c.6.214 1.114.614 1.49 1.128.385.528.585 1.157.585 1.82 0 .37-.057.742-.171 1.085l-.114.3-.043.042c-.157.358-.357.7-.6 1l-.1.129c-.285.314-.6.585-.942.799-.286.185-.586.328-.9.414-.314.085-.642.128-.97.114l-.143-.014c-.385-.043-.757-.143-1.1-.3l-.128-.057c-.357-.157-.686-.371-.971-.628l-.214-.214a4.64 4.64 0 01-.814-1.086l-.086-.171c-.17-.343-.285-.714-.328-1.1l-.014-.128a3.57 3.57 0 01.057-1.014l.028-.143c.057-.328.157-.642.3-.942l.07-.143c.158-.3.358-.571.586-.814l.1-.114c.214-.228.457-.428.728-.585l.1-.057c.285-.186.6-.328.928-.428l.129-.043c.342-.1.7-.157 1.057-.157h.128c.329 0 .657.043.971.114l.1.029c.357.085.7.214 1.014.385l.114.057c.428.228.814.514 1.143.857l.128.142c.285.314.514.671.7 1.057l.057.128c.157.342.257.7.3 1.071l.014.143v.314c0 .443-.086.885-.228 1.3l-.072.2c-.2.528-.514 1.028-.9 1.447l-.086.086.043.042c.643.7.957 1.505 1.014 2.318.029.428-.042.857-.185 1.271z" />
      </svg>
    ),
    Tailwind: (
      <svg viewBox="0 0 24 24" fill={color} className="w-full h-full">
        <path d="M12.001 4.8c-3.2 0-5.2 1.6-6 4.8 1.2-1.6 2.6-2.2 4.2-1.8.913.228 1.565.89 2.288 1.624C13.666 10.618 15.027 12 18.001 12c3.2 0 5.2-1.6 6-4.8-1.2 1.6-2.6 2.2-4.2 1.8-.913-.228-1.565-.89-2.288-1.624C16.337 6.182 14.976 4.8 12.001 4.8zm-6 7.2c-3.2 0-5.2 1.6-6 4.8 1.2-1.6 2.6-2.2 4.2-1.8.913.228 1.565.89 2.288 1.624 1.177 1.194 2.538 2.576 5.512 2.576 3.2 0 5.2-1.6 6-4.8-1.2 1.6-2.6 2.2-4.2 1.8-.913-.228-1.565-.89-2.288-1.624C10.337 13.382 8.976 12 6.001 12z" />
      </svg>
    ),
    Express: (
      <svg viewBox="0 0 24 24" fill={color} className="w-full h-full">
        <path d="M24 18.588a1.529 1.529 0 01-1.895-.72l-3.45-4.771-.5-.667-4.003 5.444a1.466 1.466 0 01-1.802.708l5.158-6.92-4.798-6.251a1.595 1.595 0 011.9.666l3.576 4.83 3.596-4.81a1.435 1.435 0 011.788-.668L21.708 7.9l-2.522 3.283a.666.666 0 000 .994l4.804 6.412zM.002 11.576l.42-2.075c1.154-4.103 5.858-5.81 9.094-3.27 1.895 1.489 2.368 3.597 2.275 5.973H1.116C.943 16.447 4.005 19.009 7.92 17.7a4.078 4.078 0 002.582-2.876c.207-.666.548-.78 1.174-.588a5.417 5.417 0 01-2.589 3.957 6.272 6.272 0 01-7.306-.933 6.575 6.575 0 01-1.64-3.858c0-.235-.08-.455-.134-.666A88.33 88.33 0 010 11.577zm1.127-.286h9.654c-.06-3.076-2.001-5.258-4.59-5.278-2.882-.04-4.944 2.094-5.071 5.264z" />
      </svg>
    ),
    "VS Code": (
      <svg viewBox="0 0 24 24" fill={color} className="w-full h-full">
        <path d="M23.15 2.587L18.21.21a1.494 1.494 0 00-1.705.29l-9.46 8.63-4.12-3.128a.999.999 0 00-1.276.057L.327 7.261A1 1 0 00.326 8.74L3.899 12 .326 15.26a1 1 0 00.001 1.479L1.65 17.94a.999.999 0 001.276.057l4.12-3.128 9.46 8.63a1.492 1.492 0 001.704.29l4.942-2.377A1.5 1.5 0 0024 20.06V3.939a1.5 1.5 0 00-.85-1.352zm-5.146 14.861L10.826 12l7.178-5.448v10.896z" />
      </svg>
    ),
    Figma: (
      <svg viewBox="0 0 24 24" fill={color} className="w-full h-full">
        <path d="M15.852 8.981h-4.588V0h4.588c2.476 0 4.49 2.014 4.49 4.49s-2.014 4.491-4.49 4.491zM12.735 7.51h3.117c1.665 0 3.019-1.355 3.019-3.019s-1.355-3.019-3.019-3.019h-3.117V7.51zm0 1.471H8.148c-2.476 0-4.49-2.014-4.49-4.49S5.672 0 8.148 0h4.588v8.981zm-4.587-7.51c-1.665 0-3.019 1.355-3.019 3.019s1.354 3.02 3.019 3.02h3.117V1.471H8.148zm4.587 15.019H8.148c-2.476 0-4.49-2.014-4.49-4.49s2.014-4.49 4.49-4.49h4.588v8.98zM8.148 8.981c-1.665 0-3.019 1.355-3.019 3.019s1.355 3.019 3.019 3.019h3.117V8.981H8.148zM8.172 24c-2.489 0-4.515-2.014-4.515-4.49s2.014-4.49 4.49-4.49h4.588v4.441c0 2.503-2.047 4.539-4.563 4.539zm-.024-7.51a3.023 3.023 0 00-3.019 3.019c0 1.665 1.365 3.019 3.044 3.019 1.705 0 3.093-1.376 3.093-3.068v-2.97H8.148zm7.704 0h-.098c-2.476 0-4.49-2.014-4.49-4.49s2.014-4.49 4.49-4.49h.098c2.476 0 4.49 2.014 4.49 4.49s-2.014 4.49-4.49 4.49zm-.098-7.509c-1.665 0-3.019 1.355-3.019 3.019s1.355 3.019 3.019 3.019h.098c1.665 0 3.019-1.355 3.019-3.019s-1.355-3.019-3.019-3.019h-.098z" />
      </svg>
    ),
    Vercel: (
      <svg viewBox="0 0 24 24" fill={color} className="w-full h-full">
        <path d="M24 22.525H0l12-21.05 12 21.05z" />
      </svg>
    ),
    Flutter: (
      <svg viewBox="0 0 24 24" fill={color} className="w-full h-full">
        <path d="M14.314 0L2.3 12 6 15.7 21.684.013h-7.357zm.014 11.072L7.857 17.53l6.47 6.47H21.7l-6.46-6.468 6.46-6.46h-7.37z" />
      </svg>
    ),
    Firebase: (
      <svg viewBox="0 0 24 24" fill={color} className="w-full h-full">
        <path d="M3.89 15.672L6.255.461A.542.542 0 017.27.288l2.543 4.771zm16.794 3.692l-2.25-14a.54.54 0 00-.919-.295L3.316 19.365l7.856 4.427a1.621 1.621 0 001.588 0zM14.3 7.147l-1.82-3.482a.542.542 0 00-.96 0L3.53 17.984z" />
      </svg>
    ),
    GraphQL: (
      <svg viewBox="0 0 24 24" fill={color} className="w-full h-full">
        <path d="M14.051 2.751l4.935 2.85c.816-.859 2.173-.893 3.032-.077.148.14.274.301.377.477.589 1.028.232 2.339-.796 2.928-.174.1-.361.175-.558.223v5.699c1.146.273 1.854 1.423 1.58 2.569-.048.204-.127.4-.232.581-.592 1.023-1.901 1.374-2.927.782-.196-.113-.375-.259-.526-.428l-4.905 2.832c.372 1.124-.238 2.335-1.361 2.706-.217.071-.442.108-.67.108-1.181.001-2.139-.955-2.14-2.136 0-.205.029-.41.088-.609l-4.936-2.847c-.816.854-2.171.887-3.026.07-.854-.816-.886-2.171-.07-3.026.283-.297.646-.506 1.044-.603l.001-5.699c-1.15-.276-1.858-1.433-1.581-2.584.047-.198.123-.389.224-.566.603-1.017 1.916-1.352 2.933-.749.177.105.336.236.472.388l4.938-2.85C9.613 1.612 10.26.423 11.39.088 11.587.029 11.794 0 12 0c1.181-.001 2.139.954 2.14 2.134.001.209-.03.418-.089.617z" />
      </svg>
    ),
    Sass: (
      <svg viewBox="0 0 24 24" fill={color} className="w-full h-full">
        <path d="M12 0c6.627 0 12 5.373 12 12s-5.373 12-12 12S0 18.627 0 12 5.373 0 12 0zM9.615 15.998c.175.645.156 1.248-.024 1.792l-.065.18c-.024.061-.052.12-.078.176-.14.29-.326.56-.555.81-.698.759-1.672 1.047-2.09.805-.45-.262-.226-1.335.584-2.19.871-.918 2.12-1.509 2.12-1.509v-.003l.108-.061zm9.911-10.861c-.542-2.133-4.077-2.834-7.422-1.645-1.989.707-4.144 1.818-5.693 3.267C4.568 8.48 4.275 9.98 4.396 10.607c.427 2.211 3.457 3.657 4.703 4.73v.006c-.367.18-3.056 1.529-3.686 2.925-.675 1.47.105 2.521.615 2.655 1.575.436 3.195-.36 4.065-1.649.84-1.261.766-2.881.404-3.676.496-.135 1.08-.195 1.83-.104 2.101.24 2.521 1.56 2.43 2.1-.09.539-.523.854-.674.944-.15.091-.195.12-.181.181.015.09.091.09.21.075.165-.03 1.096-.45 1.141-1.471.045-1.29-1.186-2.729-3.375-2.7-.9.016-1.471.091-1.875.256-.03-.045-.061-.075-.105-.105-1.35-1.455-3.855-2.475-3.75-4.41.03-.705.285-2.564 4.8-4.814 3.705-1.846 6.661-1.335 7.171-.21.733 1.604-1.576 4.59-5.431 5.024-1.47.165-2.235-.404-2.431-.615-.209-.225-.239-.24-.314-.194-.12.06-.045.255 0 .375.12.3.585.825 1.396 1.095.704.225 2.43.359 4.5-.45 2.324-.899 4.139-3.405 3.614-5.505l.073.067z" />
      </svg>
    ),
    Jest: (
      <svg viewBox="0 0 24 24" fill={color} className="w-full h-full">
        <path d="M22.251 11.82a3.117 3.117 0 00-2.328-3.01L22.911 0H8.104L11.1 8.838a3.116 3.116 0 00-2.244 2.988c0 1.043.52 1.967 1.313 2.536a8.279 8.279 0 01-1.084 1.244 8.14 8.14 0 01-2.55 1.647c-.834-.563-1.195-1.556-.869-2.446a3.11 3.11 0 00-.91-6.08 3.117 3.117 0 00-3.113 3.113c0 .848.347 1.626.903 2.182-.048.097-.097.195-.146.299-.465.959-.993 2.043-1.195 3.259-.403 2.432.257 4.384 1.849 5.489A5.093 5.093 0 005.999 24c1.827 0 3.682-.917 5.475-1.807 1.279-.636 2.468-1.234 3.435-1.487.391-.101.791-.158 1.21-.158 1.053 0 1.993.397 2.64.792.332-.246.664-.539.99-.878 1.197-1.238 1.758-2.721 1.684-4.315-.035-.703-.208-1.399-.512-2.007a3.122 3.122 0 001.33-2.52zM9.38 3.89h6.248L13.76 9.33h-2.512L9.38 3.89zm3.122 10.188a1.144 1.144 0 01-1.143-1.143c0-.629.514-1.143 1.143-1.143.63 0 1.143.514 1.143 1.143a1.144 1.144 0 01-1.143 1.143z" />
      </svg>
    ),
    Cypress: (
      <svg viewBox="0 0 24 24" fill={color} className="w-full h-full">
        <path d="M11.998 0C5.366 0 0 5.367 0 12a11.992 11.992 0 0 0 12 12c6.633 0 12-5.367 12-12-.001-6.633-5.412-12-12.002-12zM6.37 14.575c.392.523.916.742 1.657.742.35 0 .699-.044 1.004-.175.306-.13.655-.306 1.09-.567l1.223 1.745c-1.003.83-2.138 1.222-3.447 1.222-1.048 0-1.92-.218-2.705-.654a4.393 4.393 0 0 1-1.746-1.92c-.392-.83-.611-1.79-.611-2.925 0-1.09.219-2.094.61-2.923a4.623 4.623 0 0 1 1.748-2.007c.741-.48 1.657-.698 2.661-.698.699 0 1.353.087 1.877.305a5.64 5.64 0 0 1 1.614.96l-1.222 1.658A4.786 4.786 0 0 0 9.12 8.77c-.305-.13-.698-.174-1.048-.174-1.483 0-2.225 1.134-2.225 3.446-.043 1.18.175 2.008.524 2.532H6.37zm12 2.705c-.436 1.353-1.091 2.357-2.008 3.055-.916.698-2.006 1.048-3.316 1.048-.523 0-1.048-.044-1.484-.13l.218-2.096c.35.044.742.087 1.135.087 1.745 0 2.879-1.004 3.403-3.012l.131-.436-3.403-8.381h2.618l2.05 5.89 2.138-5.89h2.487L18.37 17.28z" />
      </svg>
    ),
    Framer: (
      <svg viewBox="0 0 24 24" fill={color} className="w-full h-full">
        <path d="M4 0h16v8h-8zM4 8h8l8 8H4zM4 16h8v8z" />
      </svg>
    ),
    Sanity: (
      <svg viewBox="0 0 24 24" fill={color} className="w-full h-full">
        <path d="M7.394 5.49c0 2.247 1.352 3.597 4.06 4.5l2.9.967c2.597.862 4.186 2.257 4.186 4.766 0 .252-.018.502-.054.748a5.712 5.712 0 0 0 .954-3.22c0-2.266-1.277-3.636-4.096-4.59l-2.832-.93c-2.38-.78-4.13-1.974-4.13-4.675 0-.385.033-.764.097-1.134A5.71 5.71 0 0 0 7.394 5.49ZM16.633 16.59c-1.007 1.092-2.574 1.907-4.895 1.907-3.474 0-5.74-1.727-6.277-4.632h4.124c.37 1.09 1.284 1.727 2.727 1.727 1.795 0 2.864-.885 2.864-2.368v-.07l1.457 3.436Z" />
      </svg>
    ),
    "REST APIs": (
      <svg viewBox="0 0 24 24" fill={color} className="w-full h-full">
        <path d="M4 4h16v4H4V4zm0 6h16v4H4v-4zm0 6h16v4H4v-4z" />
      </svg>
    ),
    "CI/CD": (
      <svg viewBox="0 0 24 24" fill={color} className="w-full h-full">
        <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" />
      </svg>
    ),
  };

  return iconMap[name] || (
    <div className="w-full h-full flex items-center justify-center text-[8px] font-bold">
      {name.substring(0, 2).toUpperCase()}
    </div>
  );
}

// Smooth lerp function
function lerp(start: number, end: number, factor: number): number {
  return start + (end - start) * factor;
}

// Default rotation speed
const DEFAULT_SPEED = 0.004;

// 3D Icon Cloud Component with smooth physics
function IconCloud() {
  const containerRef = useRef<HTMLDivElement>(null);
  const cloudRef = useRef<HTMLDivElement>(null);
  const animationRef = useRef<number | undefined>(undefined);

  // Rotation state
  const rotationRef = useRef({ x: 0, y: 0 });
  const velocityRef = useRef({ x: 0, y: DEFAULT_SPEED });

  // Mouse tracking for velocity calculation
  const lastMouseRef = useRef({ x: 0, y: 0, time: 0 });
  const mouseVelocityRef = useRef({ x: 0, y: 0 });
  const isInsideSphereRef = useRef(false);
  const lastDirectionRef = useRef({ x: 0, y: 1 }); // Default direction (rotate right)
  const isMovingRef = useRef(false);
  const moveTimeoutRef = useRef<NodeJS.Timeout | null>(null);

  // Calculate sphere positions using Fibonacci distribution
  const iconPositions = useCallback(() => {
    return technologies.map((tech, index) => {
      if (tech.isCenter) {
        return { ...tech, x: 0, y: 0, z: 0, scale: 1.4 };
      }

      const total = technologies.length - 1;
      const i = index > 8 ? index - 1 : index;
      const phi = Math.acos(1 - (2 * (i + 0.5)) / total);
      const theta = Math.PI * (1 + Math.sqrt(5)) * i;

      const radius = 150;
      const x = radius * Math.sin(phi) * Math.cos(theta);
      const y = radius * Math.sin(phi) * Math.sin(theta);
      const z = radius * Math.cos(phi);

      return { ...tech, x, y, z, scale: 1 };
    });
  }, []);

  const positions = iconPositions();

  // Transform 3D position based on rotation
  const transform3D = useCallback((x: number, y: number, z: number, rotX: number, rotY: number) => {
    // Rotate around Y axis
    const cosY = Math.cos(rotY);
    const sinY = Math.sin(rotY);
    let newX = x * cosY - z * sinY;
    let newZ = x * sinY + z * cosY;

    // Rotate around X axis
    const cosX = Math.cos(rotX);
    const sinX = Math.sin(rotX);
    const newY = y * cosX - newZ * sinX;
    newZ = y * sinX + newZ * cosX;

    return { x: newX, y: newY, z: newZ };
  }, []);

  // Animation loop with smooth physics
  useEffect(() => {
    const animate = () => {
      let targetVelX: number;
      let targetVelY: number;

      if (isInsideSphereRef.current && isMovingRef.current) {
        // User is moving mouse inside sphere - match their speed
        targetVelX = mouseVelocityRef.current.x;
        targetVelY = mouseVelocityRef.current.y;
      } else {
        // Not moving or outside sphere - use default speed in last direction
        const dirMagnitude = Math.sqrt(
          lastDirectionRef.current.x * lastDirectionRef.current.x +
          lastDirectionRef.current.y * lastDirectionRef.current.y
        );

        if (dirMagnitude > 0) {
          targetVelX = (lastDirectionRef.current.x / dirMagnitude) * DEFAULT_SPEED;
          targetVelY = (lastDirectionRef.current.y / dirMagnitude) * DEFAULT_SPEED;
        } else {
          targetVelX = 0;
          targetVelY = DEFAULT_SPEED;
        }
      }

      // Smooth interpolation to target velocity
      const lerpFactor = isMovingRef.current ? 0.15 : 0.03;
      velocityRef.current.x = lerp(velocityRef.current.x, targetVelX, lerpFactor);
      velocityRef.current.y = lerp(velocityRef.current.y, targetVelY, lerpFactor);

      // Apply velocity to rotation
      rotationRef.current.x += velocityRef.current.x;
      rotationRef.current.y += velocityRef.current.y;

      // Update DOM directly for performance
      if (cloudRef.current) {
        const icons = cloudRef.current.children;

        for (let i = 0; i < positions.length; i++) {
          const pos = positions[i];
          const { x, y, z } = transform3D(pos.x, pos.y, pos.z, rotationRef.current.x, rotationRef.current.y);

          const depth = (z + 250) / 500;
          const scale = (0.5 + depth * 0.7) * pos.scale;
          const opacity = 0.2 + depth * 0.8;

          const icon = icons[i] as HTMLElement;
          if (icon) {
            icon.style.transform = `translate(-50%, -50%) translate3d(${x}px, ${y}px, 0px)`;
            icon.style.opacity = String(opacity);
            icon.style.zIndex = String(Math.round(z + 300));

            const innerDiv = icon.firstChild as HTMLElement;
            if (innerDiv) {
              innerDiv.style.transform = `scale(${scale})`;
            }
          }
        }
      }

      animationRef.current = requestAnimationFrame(animate);
    };

    animationRef.current = requestAnimationFrame(animate);
    return () => {
      if (animationRef.current) cancelAnimationFrame(animationRef.current);
    };
  }, [positions, transform3D]);

  // Mouse move handler
  const handleMouseMove = useCallback((e: React.MouseEvent) => {
    if (!cloudRef.current) return;

    const rect = cloudRef.current.getBoundingClientRect();
    const centerX = rect.left + rect.width / 2;
    const centerY = rect.top + rect.height / 2;

    // Calculate distance from center
    const distX = e.clientX - centerX;
    const distY = e.clientY - centerY;
    const distance = Math.sqrt(distX * distX + distY * distY);

    // Check if inside sphere radius
    isInsideSphereRef.current = distance < 250;

    if (isInsideSphereRef.current) {
      const now = performance.now();
      const dt = now - lastMouseRef.current.time;

      if (dt > 0 && lastMouseRef.current.time > 0) {
        // Calculate mouse velocity (pixels per ms, then scale for rotation)
        const dx = e.clientX - lastMouseRef.current.x;
        const dy = e.clientY - lastMouseRef.current.y;

        // Convert mouse movement to rotation velocity
        // Horizontal mouse movement (dx) -> Y-axis rotation
        // Vertical mouse movement (dy) -> X-axis rotation
        // Reduced sensitivity for comfortable viewing
        const sensitivity = 0.00003; // Much lower for comfortable speed
        const rawVelX = -dy * sensitivity * (1000 / dt); // Invert for natural feel
        const rawVelY = dx * sensitivity * (1000 / dt);

        // Smooth the velocity to avoid jitter
        mouseVelocityRef.current.x = lerp(mouseVelocityRef.current.x, rawVelX, 0.3);
        mouseVelocityRef.current.y = lerp(mouseVelocityRef.current.y, rawVelY, 0.3);

        // Update last direction if there's significant movement
        const speed = Math.sqrt(dx * dx + dy * dy);
        if (speed > 2) {
          lastDirectionRef.current = {
            x: -dy, // Vertical mouse -> X rotation
            y: dx,  // Horizontal mouse -> Y rotation
          };
          isMovingRef.current = true;

          // Clear existing timeout
          if (moveTimeoutRef.current) {
            clearTimeout(moveTimeoutRef.current);
          }

          // Set timeout to detect when mouse stops moving
          moveTimeoutRef.current = setTimeout(() => {
            isMovingRef.current = false;
          }, 100);
        }
      }

      lastMouseRef.current = { x: e.clientX, y: e.clientY, time: now };
    }
  }, []);

  // Handle mouse leave
  const handleMouseLeave = useCallback(() => {
    isInsideSphereRef.current = false;
    isMovingRef.current = false;
    if (moveTimeoutRef.current) {
      clearTimeout(moveTimeoutRef.current);
    }
  }, []);

  // Handle mouse enter - reset tracking
  const handleMouseEnter = useCallback(() => {
    lastMouseRef.current = { x: 0, y: 0, time: 0 };
    mouseVelocityRef.current = { x: 0, y: 0 };
  }, []);

  // Cleanup timeout on unmount
  useEffect(() => {
    return () => {
      if (moveTimeoutRef.current) {
        clearTimeout(moveTimeoutRef.current);
      }
    };
  }, []);

  return (
    <div
      ref={containerRef}
      className="relative w-full h-[350px] md:h-[420px]"
    >
      {/* Center glow effect */}
      <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-48 h-48 bg-cyan-500/10 rounded-full blur-3xl pointer-events-none" />

      {/* Interactive cloud area */}
      <div
        ref={cloudRef}
        className="absolute top-1/2 left-1/2 w-[500px] h-[500px] -translate-x-1/2 -translate-y-1/2 cursor-grab active:cursor-grabbing"
        style={{ perspective: "1000px" }}
        onMouseMove={handleMouseMove}
        onMouseEnter={handleMouseEnter}
        onMouseLeave={handleMouseLeave}
      >
        {positions.map((tech) => (
          <div
            key={tech.name}
            className="absolute left-1/2 top-1/2"
            style={{
              willChange: "transform, opacity",
            }}
          >
            <div
              className={`
                group flex items-center justify-center rounded-xl
                border backdrop-blur-sm
                transition-colors duration-200 hover:border-cyan-500/50
                ${tech.isCenter ? 'shadow-lg shadow-cyan-500/20 w-14 h-14' : 'w-11 h-11'}
              `}
              style={{
                backgroundColor: 'var(--color-code-bg)',
                borderColor: 'var(--color-border)',
                willChange: 'transform',
              }}
            >
              <div
                className={`transition-transform duration-200 group-hover:scale-110 ${tech.isCenter ? 'w-8 h-8' : 'w-6 h-6'}`}
                style={{ color: tech.color }}
              >
                <IconByName name={tech.name} color={tech.color} />
              </div>

              {/* Tooltip */}
              <div
                className="absolute -bottom-8 left-1/2 -translate-x-1/2 px-2 py-1 rounded text-[10px] whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-50"
                style={{ backgroundColor: 'var(--color-code-header)', borderColor: 'var(--color-border)', color: 'var(--color-text-primary)', border: '1px solid var(--color-border)' }}
              >
                {tech.name}
              </div>
            </div>
          </div>
        ))}
      </div>
    </div>
  );
}

export interface SkillsProps {
  heading?: string;
  subheading?: string;
}

export default function Skills({ heading, subheading }: SkillsProps) {
  return (
    <section id="skills" className="py-[35px] md:py-[60px] overflow-hidden">
      <div className="container mx-auto">
        {/* Section Header */}
        <AnimatedSectionHeading
          badge="My Tech Stack"
          heading={
            heading ? (
              heading.includes("Technologies") ? (
                <>
                  {heading.split("Technologies")[0]}
                  <span className="gradient-text">Technologies</span>
                  {heading.split("Technologies")[1]}
                </>
              ) : (
                (() => {
                  const words = heading.split(' ');
                  const lastWord = words.pop();
                  return <>{words.join(' ')} <span className="gradient-text">{lastWord}</span></>;
                })()
              )
            ) : (
              <>
                Skills & <span className="gradient-text">Technologies</span>
              </>
            )
          }
          subheading={subheading || "A comprehensive toolkit of modern technologies I use to build exceptional digital experiences"}
        />

        {/* Icon Cloud */}
        <motion.div
          initial={{ opacity: 0, scale: 0.9 }}
          whileInView={{ opacity: 1, scale: 1 }}
          transition={{ duration: 0.8 }}
          viewport={{ once: true }}
        >
          <IconCloud />
        </motion.div>

        {/* Skills Grid - 40px gap from cloud */}
        <motion.div
          initial={{ opacity: 0, y: 40 }}
          whileInView={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.6, delay: 0.2 }}
          viewport={{ once: true }}
          className="mt-[40px]"
        >
          <SkillsGrid />
        </motion.div>
      </div>
    </section>
  );
}

// Skills Grid Component
function SkillsGrid() {
  const skillCategories = [
    {
      icon: (
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-6 h-6">
          <path d="M16 18l6-6-6-6M8 6l-6 6 6 6" />
        </svg>
      ),
      title: "Frontend Development",
      skills: [
        { name: "React", color: "#61DAFB" },
        { name: "Next.js", color: "#ffffff" },
        { name: "TypeScript", color: "#3178C6" },
        { name: "Tailwind", color: "#06B6D4" },
        { name: "HTML5", color: "#E34F26" },
        { name: "CSS3", color: "#1572B6" },
      ],
    },
    {
      icon: (
        <svg viewBox="0 0 24 24" fill="currentColor" className="w-6 h-6">
          <path d="M12 3C7.03 3 3 7.03 3 12s4.03 9 9 9 9-4.03 9-9-4.03-9-9-9zm0 16c-3.86 0-7-3.14-7-7s3.14-7 7-7 7 3.14 7 7-3.14 7-7 7z" />
          <circle cx="12" cy="12" r="2" />
        </svg>
      ),
      title: "Backend Development",
      skills: [
        { name: "Node.js", color: "#339933" },
        { name: "Express", color: "#ffffff" },
        { name: "MongoDB", color: "#47A248" },
        { name: "MySQL", color: "#4479A1" },
        { name: "GraphQL", color: "#E10098" },
        { name: "REST APIs", color: "#00D9FF" },
      ],
    },
    {
      icon: (
        <svg viewBox="0 0 24 24" fill="currentColor" className="w-6 h-6">
          <path d="M3 3h8v8H3V3zm10 0h8v8h-8V3zM3 13h8v8H3v-8zm10 0h8v8h-8v-8z" />
        </svg>
      ),
      title: "UI/UX Design",
      skills: [
        { name: "Figma", color: "#F24E1E" },
        { name: "Framer", color: "#0055FF" },
        { name: "Responsive Design", color: "#06B6D4" },
        { name: "Prototyping", color: "#FF6B35" },
      ],
    },
    {
      icon: (
        <svg viewBox="0 0 24 24" fill="currentColor" className="w-6 h-6">
          <path d="M19.36 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.64-4.96z" />
        </svg>
      ),
      title: "Cloud & DevOps",
      skills: [
        { name: "AWS", color: "#FF9900" },
        { name: "Docker", color: "#2496ED" },
        { name: "Git", color: "#F05032" },
        { name: "GitHub", color: "#ffffff" },
        { name: "Vercel", color: "#ffffff" },
        { name: "CI/CD", color: "#00D9FF" },
      ],
    },
    {
      icon: (
        <svg viewBox="0 0 24 24" fill="currentColor" className="w-6 h-6">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z" />
        </svg>
      ),
      title: "Tools & Technologies",
      skills: [
        { name: "VS Code", color: "#007ACC" },
        { name: "Jest", color: "#C21325" },
        { name: "Cypress", color: "#17202C" },
        { name: "Redux", color: "#764ABC" },
        { name: "Firebase", color: "#FFCA28" },
        { name: "Sanity", color: "#F03E2F" },
      ],
    },
    {
      icon: (
        <svg viewBox="0 0 24 24" fill="currentColor" className="w-6 h-6">
          <path d="M9 21c0 .5.4 1 1 1h4c.6 0 1-.5 1-1v-1H9v1zm3-19C8.1 2 5 5.1 5 9c0 2.4 1.2 4.5 3 5.7V17c0 .5.4 1 1 1h6c.6 0 1-.5 1-1v-2.3c1.8-1.3 3-3.4 3-5.7 0-3.9-3.1-7-7-7z" />
        </svg>
      ),
      title: "Automation & Marketing",
      skills: [
        { name: "WordPress", color: "#21759B" },
        { name: "GoHighLevel", color: "#FF6B35" },
        { name: "n8n", color: "#EA4B71" },
        { name: "ClickFunnels", color: "#0066FF" },
        { name: "Zapier", color: "#FF4A00" },
      ],
    },
  ];

  return (
    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mt-10">
      {skillCategories.map((category, index) => (
        <SkillCard key={category.title} category={category} index={index} />
      ))}
    </div>
  );
}

// Skill Card with Mouse Hover Spotlight Effect
function SkillCard({
  category,
  index
}: {
  category: {
    icon: React.ReactElement;
    title: string;
    skills: Array<{ name: string; color: string }>;
  };
  index: number;
}) {
  const [mousePosition, setMousePosition] = useState({ x: 0, y: 0 });
  const [isHovering, setIsHovering] = useState(false);
  const cardRef = useRef<HTMLDivElement>(null);

  const handleMouseMove = (e: React.MouseEvent<HTMLDivElement>) => {
    if (!cardRef.current) return;
    const rect = cardRef.current.getBoundingClientRect();
    setMousePosition({
      x: e.clientX - rect.left,
      y: e.clientY - rect.top,
    });
  };

  return (
    <motion.div
      ref={cardRef}
      initial={{ opacity: 0, y: 20 }}
      whileInView={{ opacity: 1, y: 0 }}
      transition={{ duration: 0.5, delay: index * 0.1 }}
      viewport={{ once: true }}
      onMouseMove={handleMouseMove}
      onMouseEnter={() => setIsHovering(true)}
      onMouseLeave={() => setIsHovering(false)}
      className="group relative p-6 rounded-xl border border-transparent overflow-hidden"
      style={{
        background: isHovering
          ? `radial-gradient(circle 200px at ${mousePosition.x}px ${mousePosition.y}px, rgba(var(--glow-accent-rgb), var(--glow-bg-intensity)), transparent), var(--color-card-surface)`
          : 'var(--color-card-surface)',
      }}
    >
      {/* Animated border glow that follows mouse */}
      <div
        className="absolute inset-0 rounded-xl pointer-events-none transition-opacity duration-300"
        style={{
          background: `radial-gradient(circle 150px at ${mousePosition.x}px ${mousePosition.y}px, rgba(var(--glow-accent-rgb), var(--glow-accent-intensity)), transparent)`,
          opacity: isHovering ? 1 : 0,
          mask: 'linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0)',
          WebkitMask: 'linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0)',
          maskComposite: 'xor',
          WebkitMaskComposite: 'xor',
          padding: '1.5px',
        }}
      />
      {/* Static border */}
      <div className="absolute inset-0 rounded-xl border border-cyan-500/20 pointer-events-none" />

      {/* Content */}
      <div className="relative z-10">
        {/* Icon */}
        <div className="flex items-center gap-3 mb-4">
          <div className="p-2 rounded-lg bg-cyan-500/10 text-cyan-400 group-hover:bg-cyan-500/20 transition-colors">
            {category.icon}
          </div>
          <h3 className="text-lg font-semibold" style={{ color: 'var(--color-text-heading)' }}>{category.title}</h3>
        </div>

        {/* Skills List */}
        <div className="flex flex-wrap gap-3">
          {category.skills.map((skill) => (
            <div
              key={skill.name}
              className="flex items-center gap-2 px-3 py-1.5 rounded-lg bg-dark-secondary/50 border border-white/5 hover:border-cyan-500/30 transition-all duration-200 group/item"
            >
              <div className="w-4 h-4 flex-shrink-0" style={{ color: skill.color }}>
                <IconByName name={skill.name} color={skill.color} />
              </div>
              <span className="text-sm transition-colors" style={{ color: 'var(--color-text-secondary)' }}>
                {skill.name}
              </span>
            </div>
          ))}
        </div>
      </div>
    </motion.div>
  );
}
